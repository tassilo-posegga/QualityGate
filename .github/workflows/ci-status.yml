name: CI Status Test

on:
  workflow_dispatch:
    inputs:
      status:
        description: 'CI Status to set'
        required: true
        default: 'success'
        type: choice
        options:
        - success
        - failure
        - pending
        - error

permissions:
  contents: write

jobs:
  set-status:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      
      - name: Update README
        run: |
          echo "# QualityGate CI: ${{ github.event.inputs.status }}" > README.md
      
      - name: Commit README
        uses: EndBug/add-and-commit@v9
        with:
          message: "Set CI status: ${{ github.event.inputs.status }}"
      
      - name: Set Commit Status
        run: |
          SHA=$(git rev-parse HEAD)
          curl -X POST \
            -H "Authorization: token ${{ secrets.GITHUB_TOKEN }}" \
            -H "Accept: application/vnd.github+json" \
            https://api.github.com/repos/${{ github.repository }}/statuses/${SHA} \
            -d '{
              "state": "${{ github.event.inputs.status }}",
              "context": "QualityGate Test",
              "description": "Manual CI status test"
            }'
